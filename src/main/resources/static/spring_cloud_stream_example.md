# Spring cloud stream example

This is a simple example of spring cloud stream with kafka binder.

---

## Imports

You will need to import the following dependencies :

```xml

<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-stream-kafka</artifactId>
    <version>4.0.4</version>
</dependency>

```

```xml

<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-stream</artifactId>
    <version>4.0.4</version>
</dependency>

 ```

---

## Application properties editing

This section will explain how to edit the application.yml to configure the different properties bindings.

[Configuration properties](configuration_properties.md#configuration-file-editing)

---

## Code binding and producing

In this section, there are documented examples to help understanding the different processes.

[Cloud binding](cloud_binding.md#code-binding-and-producing)

---

## Message

Message is a class that represent a message in the kafka topic.

```java
import org.springframework.messaging.Message;

class Example {
  public void manipulateMessage(final Message<String> message) {
    // The Message class contains two main parts :

    // The payload, which is the message itself
    final String payload = message.getPayload();

    // The headers, which contains metadata about the message
    final MessageHeaders headers = message.getHeaders();
  }

  public Message<String> newMessage() {
    // You can add your own headers with a Map
    // However, some headers might be overridden by the binder
    // Here we add a date header to indicate when it was made
    final Map<String, Object> newHeaders = Map.of(
        "date", LocalDateTime.now().toString()
    );

    // The content of your message.
    // You define the type of content with the object type passed in '<>'
    final String payload = "Hello world !";

    // You can create a new message with the MessageBuilder
    return MessageBuilder
        .withPayload(payload)
        .setHeader(newHeaders)
        .build();
  }
}
```

---

## StreamBridge

The StreamBridge is an spring bean that allow to send a message to a topic.

```java
import org.springframework.cloud.stream.function.StreamBridge;

@Component
public class Producer {
  private final StreamBridge streamBridge;

  // The StreamBridge is an autogenerated spring bean, so you need to inject it in
  // your class to be able to use it
  public Producer(final StreamBridge streamBridge) {
    this.streamBridge = streamBridge;
  }

  public void produce() {
    final Message<UpdatedUser> message = MessageBuilder.build();

    // The first parameter is the name of the producer binding, as in the application.yml
    // The second parameter is the message to send
    streamBridge.send("produceToTopic-out-0", message);
  }
}
```

---
